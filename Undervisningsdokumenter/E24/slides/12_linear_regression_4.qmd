---
format: 
  revealjs:
    theme: css_etc/custom-theme-ilisimatusarfik.css
    slide-level: 0
    incremental: false 
    logo: css_etc/ilisimatusarfik.png
    highlight: true
    highlight-style: github-dark
    autoStretch: true
    self-contained: false
    preload-iframes: true
editor: visual
---

::: center
# LineÃ¦r regression 4

### Statistik E24 (15 ECTS)

### ved Mikkeline Munk Nielsen
:::

------------------------------------------------------------------------

# Program

<br>

VideregÃ¥ende regressionsanalyse:

-   Polynomier

-   Interaktionsvariable

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

-   FormÃ¥let med lineÃ¦r regression er at finde den bedst egnede linje, der minimerer forskellene mellem observerede og forudsagte vÃ¦rdier

-   Den simple lineÃ¦re regressionsmodel ser i udgangspunktet ud sÃ¥ledes:

    $$
    Y=\alpha+\beta*X+\epsilon
    $$

-   I nogle tilfÃ¦lde har man dog brug for at kunne modulere ikke-lineÃ¦re sammenhÃ¦nge mellem vores afhÃ¦ngige og uafhÃ¦ngige variable

-   I disse tilfÃ¦lde kan vi bruge polynomier i regressionsmodellen

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

Man inkluderer polynomier som variable i regressionsmodellen:

<br>

LineÃ¦r: $Y=\alpha+\beta*X+\epsilon$

Kvadratisk: $Y=\alpha+\beta_1*X+\beta_2*X^2+\epsilon$

Kubrisk: $Y=\alpha+\beta_1*X+\beta_2*X^2+\beta_3*X^3+\epsilon$

<br>

Du polynomier er mere fleksible kan de i nogle tilfÃ¦lde give regressionslinjen et bedre "fit" til data.

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

```{r include=F, eval=T}
df <- readRDS("C:/Users/mmn/Dropbox/Ilisimatusarfik/Undervisningsdokumenter/E24/slides/data/ESS.rds") 

library(dplyr)
df <- df %>% mutate(
mand = ifelse(koen=="Mand",1,0),
kvinde = ifelse(koen=="Kvinde",1,0))

library(tidyverse)
df <- df %>% filter(land=="DK") %>% select(koen, udd, net_indkomst, alder, antal_timer_arb, land, kvinde, udd_aar) %>% na.omit()
```

UndersÃ¸g f.eks. sammenhÃ¦ngen mellem alder og indkomst i ESS datasÃ¦ttet:

::: panel-tabset
## Scatterplot

```{r echo=F, include=T, eval=T, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)"
  ) +
  theme_minimal()
```

## Kode

```{r echo=T, include=T, eval=F, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)"
  ) +
  theme_minimal()

```
:::

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

Da vi testede med regressionsanalyse, om der var en sammenhÃ¦ng mellem alder og indkomst, fik vi et insignifikant resultat og en $\beta \approx 0$â€¦ hÃ¦ldning var FLAD!

::: panel-tabset
## Scatterplot

```{r echo=F, include=T, eval=T, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +  
  theme_minimal()
```

## Kode

```{r echo=T, include=T, eval=F, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", color = "blue", se = FALSE) +  
  theme_minimal()
```
:::

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

Men mÃ¥ske er sammenhÃ¦ngen bare ikke lineÃ¦r?

::: panel-tabset
## Scatterplot

```{r echo=F, include=T, eval=T, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", 
              formula = y ~ poly(x, 2), 
              color = "blue", se = FALSE) +  
  theme_minimal()
```

## Kode

```{r echo=T, include=T, eval=F, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", formula = y ~ poly(x, 2),
              color = "blue", se = FALSE) +  
  theme_minimal()
```
:::

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression - R

<br>

-   Den lineÃ¦re specifikation er ikke sÃ¦rlig god til at beskrive sammenhÃ¦ngen mellem alder og indkomst

-   Men det er polynomiet! Vi har altsÃ¥ misspecificeret sammenhÃ¦ngen i den fÃ¸rste model

-   Vi kan inkluderer polynomier i vores regressionsmodel med specifikationen `poly` i regressionsfunktionen for at inkludere polynomier

-   Husk altid at inddrage lavere ordens variable, selvom de er insignifikante

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression - R

```{r eval=T, echo=T, warning=F, message=F}
model <- lm(net_indkomst ~ poly(alder, 2, raw = T), data = df)
texreg::screenreg(list(model), include.ci = F) 
```

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

-   I princippet kan du blive ved med at inkludere hÃ¸jere ordens polynomier

-   Afvej dog altid med test, om det faktisk giver et bedre fit til data (bedre forklaringskraft)

-   Desto mere fleksibelt polynomium desto mere prÃ¦cis bliver modellenâ€¦ men modeller kan over-fittes!

-   Occam's Razor princippet: less is more!

------------------------------------------------------------------------

## Polynomier i lineÃ¦r regression

::: panel-tabset
## Scatterplot

```{r echo=F, include=T, eval=T, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", formula = y ~ poly(x, 3),
              color = "blue", se = FALSE) +  
  theme_minimal()
```

## Kode

```{r echo=T, include=T, eval=F, message=F}
library(ggplot2)

ggplot(df) + 
  aes(x = alder, y = net_indkomst) + 
  geom_point() +
  labs(
    x = "Alder",
    y = "Indkomst (netto)") +
  geom_smooth(method = "lm", formula = y ~ poly(x, 3),
              color = "blue", se = FALSE) +  
  theme_minimal()
```
:::

------------------------------------------------------------------------

# Interaktionsvariable

-   Vi har tidligere testet fÃ¸lgende sammenhÃ¦ng mellem kÃ¸n og indkomst, hvor vi kontrollerede for antal Ã¥rs uddannelse: $indkomst=\alpha+\beta_1*kvinde+\beta_2*udd\_aar+\epsilon$

-   Modellen viste, at kvinder gennemsnitligt tjener 1931 DKK mindre end mÃ¦nd, nÃ¥r uddannelse holdes konstant.

-   Og Ã©t Ã¥rs uddannelse ekstra giver gennemsnitligt 400 DKK mere om mÃ¥neden, nÃ¥r kÃ¸n holdes konstant.

------------------------------------------------------------------------

# Interaktionsvariable

```{r eval=T, echo=T, warning=F, message=F}
model <- lm(net_indkomst ~ kvinde+udd_aar, data = df)
texreg::screenreg(list(model), include.ci = F)
```

------------------------------------------------------------------------

# Interaktionsvariable

-   Men gad vide, om â€effektenâ€ af uddannelse er forskellig for mÃ¦nd og kvinder?

-   Dette kan testes med en sÃ¥kaldt interaktionsvariabel mellem variablen koen og variablen antal Ã¥rs uddannelse

$indkomst=\alpha+\beta_1*kvinde+\beta_2*udd\_aar+\beta_3*kvinde*udd\_aar+\epsilon$

-   Med interaktioner kan man se, om effekten af Ã©n variabel pÃ¥ $Y$ er forskellig alt efter, hvilken vÃ¦rdi en anden forklarende variabel antager.

------------------------------------------------------------------------

# Interaktionsvariable

<br>

$indkomst=\alpha+\beta_1*kvinde+\beta_2*udd\_aar+\beta_3*kvinde*udd\_aar+\epsilon$

<br>

$\alpha$: den forventede indkomst for en mand med 0 Ã¥rs uddannelse

$\beta_1$: den forventede forskel i indkomst fra mÃ¦nd til kvinder

$\beta_2$: den forventede Ã¦ndring i indkomst for hvert ekstra Ã¥rs uddannelse

$\beta_3$: den ekstra forventede Ã¦ndring indkomst for hvert ekstra Ã¥rs uddannelse, hvis man er kvinde

------------------------------------------------------------------------

# Interaktionsvariable

::::: columns
::: {.column width="50%"}
-   $\alpha$: mÃ¦nd med 0 Ã¥rs uddannelse tjener gennemsnitligt 11680 DKK

-   $\beta_1$: kvinder tjener gennemsnitligt 2323 DKK mindre end mÃ¦nd men resultatet er insignifikant)

-   $\beta_2$: man tjener gennemsnitligt 388 DKK mere om mÃ¥neden for hvert Ã¥rs ekstra uddannelse

-   $\beta_3$: det estimeres at kvinder ***derudover*** tjener gennemsnitligt 28 DKK mere om mÃ¥neden end mÃ¦nd, hver gang de tager et Ã¥rs ekstra uddannelse (men resultatet er insignifikant)
:::

::: {.column width="50%"}
```{r eval=T, echo=T, warning=F, message=F}
model <- lm(net_indkomst ~ kvinde*udd_aar, 
            data = df)

texreg::screenreg(list(model), 
                  include.ci = F)
```
:::
:::::

------------------------------------------------------------------------

# Interaktionsvariable

-   Parameterestimatet for $\beta_3$ er smÃ¥t og insignifikant. Der er altsÃ¥ ikke nogen signifikant forskel pÃ¥ sammenhÃ¦ngen mellem uddannelse og indkomst for mÃ¦nd og kvinder.

-   Hvis koefficienten havde vÃ¦ret signifikant, havde det vÃ¦ret meningsfyldt at medtage den i modellen

-   Interaktionsvariable kan nemlig afslÃ¸re heterogenitet i sammenhÃ¦nge, f.eks. hvis mÃ¦nd og kvinder ikke â€fÃ¥r lige meget i lÃ¸n for at tage mere uddannelseâ€

------------------------------------------------------------------------

# Interaktionsvariable

-   Vi kan altsÃ¥ bruge interaktionsvariable til at udtale os mere prÃ¦cist om sammenhÃ¦nge for forskellige â€grupperâ€ eller â€vÃ¦rdierâ€.

-   Undlader vi at bruge interaktionsvariable fÃ¥r vi bare en samlet gennemsnitseffekt. Men i princippet kunne sammenhÃ¦ngen mellem indkomst og uddannelse have vÃ¦ret stÃ¦rkere for kvinder end mÃ¦nd (eller omvendt)

------------------------------------------------------------------------

# Interaktionsvariable

HVIS(!) interaktionskoefficienten havde vÃ¦ret signifikant skulle vi udregne forventet indkomst som fÃ¸lgende:

<br>

$indkomst=\alpha+\beta_1*kvinde+\beta_2*udd\_aar+\beta_3*kvinde*udd\_aar+\epsilon$

<br>

Mand med 0 Ã¥rs uddannelse: ğ‘–ğ‘›ğ‘‘ğ‘˜ğ‘œğ‘šğ‘ ğ‘¡=11680âˆ’(2322âˆ—0)+(388âˆ—0)+(28âˆ—0âˆ—0)=11680 ğ·ğ¾ğ¾

Kvinde med 0 Ã¥rs uddannelse: ğ‘–ğ‘›ğ‘‘ğ‘˜ğ‘œğ‘šğ‘ ğ‘¡=11680âˆ’(2322âˆ—1)+(388âˆ—0)+(28âˆ—1âˆ—0)=9358 ğ·ğ¾ğ¾

Mand med 14 Ã¥rs uddannelse: ğ‘–ğ‘›ğ‘‘ğ‘˜ğ‘œğ‘šğ‘ ğ‘¡=11680âˆ’(2322âˆ—0)+(388âˆ—14)+(28âˆ—0âˆ—0)=17112 ğ·ğ¾ğ¾

Kvinde med 20 Ã¥rs uddannelse: ğ‘–ğ‘›ğ‘‘ğ‘˜ğ‘œğ‘šğ‘ ğ‘¡=11680âˆ’(2322âˆ—1)+(266âˆ—20)+(28âˆ—1âˆ—20)=17678 ğ·ğ¾ğ¾

------------------------------------------------------------------------

# Interaktionsvariable

```{r eval=T, include=F}
df <- readRDS("C:/Users/mmn/Dropbox/Ilisimatusarfik/Undervisningsdokumenter/E24/slides/data/ESS.rds") 

library(dplyr)
df <- df %>% mutate(
mand = ifelse(koen=="Mand",1,0),
kvinde = ifelse(koen=="Kvinde",1,0),
fagforening = ifelse(fagforeningsmedlem=="Ja",1,0))

library(tidyverse)
df <- df %>% filter(land=="DK") %>% select(net_indkomst, kvinde, fagforening) %>% na.omit()
```

$indkomst=\alpha+\beta_1*kvinde+\beta_2*fagforening+\beta_3*kvinde*fagforening+\epsilon$

::::: columns
::: {.column width="50%"}
$\alpha$ : den forventede indkomst for mÃ¦nd der ikke er medlemmer af en fagforening

$\beta_1$ : forskel i indkomst fra mÃ¦nd til kvinder

$\beta_2$ : Ã¦ndringen i indkomst for medlemsskab

$\beta_3$ : yderligere Ã¦ndring i indkomst for medlemsskab HVIS man er kvinde
:::

::: {.column width="50%"}
```{r}
model <- lm(net_indkomst ~ kvinde*fagforening, data = df)
texreg::screenreg(list(model), include.ci = F)
```
:::
:::::

**Ã˜velse**: diskutÃ©r, om der er en signifikant forskel pÃ¥ sammenhÃ¦ngen mellem indkomst og fagforeningsmedlemsskab for mÃ¦nd og kvinder
